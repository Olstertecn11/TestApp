@{
ViewData["Title"] = "Carga de sucursales";
}
<h1>@ViewData["Title"]</h1>

<style>
  .container {
    margin-top: 4rem;
  }

  .upload-container {
    /* background-color: red; */
    border: 6px dotted #ccc;
    padding: 4rem 12em;
    border-radius: 12px;
    margin-bottom: 2rem;
    transition: background 0.3s ease-in-out;
  }

  .upload-container:hover {
    background: #eeeeee;
    transition: background 0.3s ease-in-out;
    cursor: pointer;
  }

  .upload-icon {
    margin-top: 2rem;
    font-size: 4rem;
    animation: float 3s ease-in-out infinite;
  }

  .upload-container>.mb-3>.d-flex>label {
    font-size: 1.1rem;
    font-weight: 100;
  }

  .file-box:focus,
  .file-box button:focus,
  .file-box button:active {
    outline: none !important;
    box-shadow: none !important;
  }


  @@keyframes float {

    0%,
    100% {
      transform: translateY(0);
    }

    50% {
      transform: translateY(-10px);
    }
  }

  .file-box {
    user-select: none;
  }

  #submitBtn {
    float: right;
  }

  #submitBtn:disabled {
    background: #f5f5f5;
    color: #666;
    cursor: not-allowed;
  }

  #submitBtn:enabled {
    background: black;
    color: white;
    cursor: pointer;
  }
</style>

<p>
  En esta pagina se podr√° cargar un archivo con las sucursales.
</p>

<div class="container">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <form asp-controller="CargaSucursal" asp-action="Upload" method="post" enctype="multipart/form-data"
        class="upload-container" id="uploadForm">
        <div class="mb-3">
          <div class="d-flex flex-column align-items-center justify-content-center">
            <label for="formFile" class="form-label">Arrastre el archivo de sucursales aqu√≠ o haga doble click
            </label>
            <i class="fa-solid fa-cloud-arrow-up upload-icon" id="icon"></i>
          </div>
          <!-- <input class="form-control" type="file" id="formFile" name="file" /> -->
        </div>
      </form>
      <button type="button" class="btn" id="submitBtn" disabled>Subir archivo <i
          class="fa-solid fa-arrow-up-from-bracket"></i></button>
    </div>
  </div>
</div>


<script>
  const form = document.getElementById('uploadForm');


  document.getElementById("submitBtn").addEventListener('click', (e) => {
    console.log('submitBtn clicked');
    e.preventDefault();
    form.submit();
  });


  form.addEventListener('dblclick', () => {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.name = 'file';
    fileInput.accept = 'application/json';
    fileInput.style.display = 'none';

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length > 0) {
        const existing = form.querySelector('input[name="file"]');
        const existingBox = form.querySelector('.file-box');
        if (existing) existing.remove();
        if (existingBox) existingBox.remove();

        form.appendChild(fileInput);

        Toastify({
          text: "Archivo seleccionado correctamente",
          className: "info",
          style: {background: "linear-gradient(to right, #00b09b, #96c93d)"}
        }).showToast();

        document.getElementById('icon').style.display = 'none';

        const fileNameBox = document.createElement('div');
        fileNameBox.className = 'file-box mt-3 p-2 border rounded d-flex justify-content-between align-items-center bg-light';
        fileNameBox.innerHTML = `
        <span>üìÑ ${fileInput.files[0].name}</span>
        <button type="button" class="btn btn-sm btn-outline-danger remove-file">
          <i class="fa-solid fa-xmark"></i>
        </button>
      `;
        form.appendChild(fileNameBox);

        fileNameBox.querySelector('.remove-file').addEventListener('click', () => {
          fileInput.remove();
          fileNameBox.remove();
          document.getElementById('icon').style.display = 'block';
          Toastify({
            text: "Archivo eliminado",
            className: "info",
            style: {background: "linear-gradient(to right, #ff5f6d, #ffc371)"}
          }).showToast();
          document.getElementById('submitBtn').disabled = true;
        });
        document.getElementById('submitBtn').disabled = false;

      } else {
        Toastify({
          text: "No se seleccion√≥ ning√∫n archivo",
          className: "info",
          style: {background: "linear-gradient(to right, #ff5f6d, #ffc371)"}
        }).showToast();
        document.getElementById('submitBtn').disabled = true;
      }

      document.activeElement.blur();

    });

    document.body.appendChild(fileInput);
    fileInput.click();
  });
</script>
